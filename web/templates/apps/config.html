{% extends "base.html" %}

{% block title %}Configure {{ app.display_name }} - LED Display{% endblock %}

{% block content %}
<div class="app-config">
    <div class="page-header">
        <a href="/apps" class="back-link">&larr; Back to Apps</a>
        <h1>{{ app.display_name }}</h1>
        <p class="description">{{ app.description }}</p>
    </div>

    <form action="/apps/{{ app.name }}/save" method="POST" class="card">
        <h2>Settings</h2>

        <!-- Enable/Disable -->
        <div class="form-group checkbox-group">
            <input type="checkbox" id="enabled" name="enabled" {% if app_config.get('enabled', True) %}checked{% endif %}>
            <label for="enabled">Enable this app</label>
        </div>

        <hr>

        <!-- Dynamic fields from schema -->
        {% for field_name, field_info in schema.items() %}
        <div class="form-group">
            <label for="{{ field_name }}">
                {{ field_info.label }}
                {% if field_info.get('required') %}<span class="required">*</span>{% endif %}
            </label>

            {% if field_info.type == 'bool' %}
            <div class="checkbox-group">
                <input type="checkbox" id="{{ field_name }}" name="{{ field_name }}"
                       {% if app_config.get(field_name, field_info.get('default', False)) %}checked{% endif %}>
            </div>

            {% elif field_info.type == 'password' %}
            <input type="password" id="{{ field_name }}" name="{{ field_name }}"
                   value="{{ app_config.get(field_name, '') }}"
                   placeholder="Enter {{ field_info.label.lower() }}"
                   {% if field_info.get('required') %}required{% endif %}>

            {% elif field_info.type == 'int' %}
            <input type="number" id="{{ field_name }}" name="{{ field_name }}"
                   value="{{ app_config.get(field_name, field_info.get('default', 0)) }}"
                   {% if field_info.get('min') is not none %}min="{{ field_info.min }}"{% endif %}
                   {% if field_info.get('max') is not none %}max="{{ field_info.max }}"{% endif %}>

            {% elif field_info.type == 'color' %}
            <input type="color" id="{{ field_name }}" name="{{ field_name }}"
                   value="{{ app_config.get(field_name, field_info.get('default', '#FFFFFF')) }}">

            {% elif field_info.type == 'select' %}
            <select id="{{ field_name }}" name="{{ field_name }}">
                {% for option in field_info.options %}
                <option value="{{ option.value }}"
                        {% if app_config.get(field_name, field_info.get('default')) == option.value %}selected{% endif %}>
                    {{ option.label }}
                </option>
                {% endfor %}
            </select>

            {% else %}
            <input type="text" id="{{ field_name }}" name="{{ field_name }}"
                   value="{{ app_config.get(field_name, field_info.get('default', '')) }}"
                   placeholder="Enter {{ field_info.label.lower() }}"
                   {% if field_info.get('required') %}required{% endif %}>
            {% endif %}

            {% if field_info.get('description') %}
            <small class="help-text">{{ field_info.description }}</small>
            {% endif %}
        </div>
        {% endfor %}

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Settings</button>
            <a href="/apps" class="btn btn-secondary">Cancel</a>
        </div>
    </form>

    {% if app.requires_credentials %}
    <div class="card info-card">
        <h3>Setup Instructions</h3>
        {% if app.name == 'weather' %}
        <p>To use the Weather app:</p>
        <ol>
            <li>Create a free account at <a href="https://openweathermap.org/api" target="_blank">OpenWeatherMap</a></li>
            <li>Generate an API key from your account dashboard</li>
            <li>Enter your API key and city name above</li>
        </ol>
        {% elif app.name == 'spotify' %}
        <p>To use the Spotify app:</p>
        <ol>
            <li>Create an app at <a href="https://developer.spotify.com/dashboard" target="_blank">Spotify Developer Dashboard</a></li>
            <li>Set the redirect URI to <code>http://localhost:8888/callback</code></li>
            <li>Copy your Client ID and Client Secret</li>
            <li>Run the authorization flow to get a refresh token</li>
        </ol>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
